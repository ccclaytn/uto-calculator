<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>UTO Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    html {
        font-size: 18px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Display', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        font-weight: 400;
        font-size: 1rem;
        line-height: 1.6;
        color: #1d1d1f;
        background: #fafafa;
        -webkit-text-size-adjust: none;
        text-rendering: optimizeLegibility;
        font-feature-settings: "kern" 1;
    }
    
    /* Layout */
    #wrapper {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        position: relative;
        z-index: 2;
    }
    
    #wrapper::before {
        content: '';
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, rgba(248, 249, 250, 0.95), rgba(233, 236, 239, 0.95));
        z-index: -1;
    }
    
    /* Header */
    #header {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        position: relative;
        padding: 4rem 0 3rem 0;
    }
    
    #header h1 {
        font-size: 3rem;
        font-weight: 700;
        color: #1d1d1f;
        margin: 0 0 0.5rem 0;
        text-shadow: none;
        letter-spacing: -0.03em;
    }
    
    #header p {
        font-size: 1.1rem;
        font-weight: 400;
        color: #86868b;
        margin: 0;
    }
    
    /* Main */
    #main {
        flex-grow: 1;
        padding: 0;
    }
    
    .inner {
        max-width: 75rem;
        margin: 0 auto;
        padding: 0 2rem;
    }
    
    /* Sections */
    section {
        padding: 2rem 0 1rem 0;
        border-top: solid 2px rgba(44,44,44,0.125);
        margin: 1.5rem 0 0 0;
    }
    
    section:first-child {
        border-top: 0;
        margin-top: 0;
        padding-top: 1rem;
    }
    
    section.special {
        text-align: center;
    }
    
    /* Typography */
    h1, h2, h3, h4, h5, h6 {
        color: #1d1d1f;
        font-weight: 600;
        line-height: 1.4;
        margin: 0 0 1rem 0;
        letter-spacing: -0.02em;
    }
    
    h1 {
        font-size: 2.5rem;
        font-weight: 700;
    }
    
    h2 {
        font-size: 1.75rem;
        font-weight: 600;
    }
    
    h3 {
        font-size: 1.35rem;
        font-weight: 600;
    }
    
    p {
        margin: 0 0 1.5rem 0;
        color: #1d1d1f;
        font-weight: 400;
    }
    
    /* Forms */
    form {
        margin: 0 0 2rem 0;
    }
    
    label {
        color: #1d1d1f;
        display: block;
        font-size: 0.9rem;
        font-weight: 500;
        margin: 0 0 0.5rem 0;
        letter-spacing: -0.01em;
    }
    
    input[type="text"] {
        appearance: none;
        background: rgba(255,255,255,0.8);
        border-radius: 12px;
        border: 1px solid rgba(0,0,0,0.1);
        color: #1d1d1f;
        display: block;
        outline: 0;
        padding: 0 1rem;
        text-decoration: none;
        width: 100%;
        height: 2.75rem;
        font-family: inherit;
        font-size: 1rem;
        font-weight: 400;
        transition: all 0.2s ease;
    }
    
    input[type="text"]:focus {
        border-color: #007aff;
        box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        background: rgba(255,255,255,1);
    }
    
    input[type="text"]::placeholder {
        color: #86868b;
        opacity: 1.0;
    }
    
    /* Buttons */
    .button {
        appearance: none;
        background-color: #007aff;
        border-radius: 12px;
        border: none;
        color: #ffffff !important;
        cursor: pointer;
        display: inline-block;
        font-family: inherit;
        font-size: 1rem;
        font-weight: 500;
        height: 2.75rem;
        letter-spacing: -0.01em;
        line-height: 2.75rem;
        outline: 0;
        padding: 0 1.5rem;
        text-align: center;
        text-decoration: none;
        white-space: nowrap;
        transition: all 0.2s ease;
        min-width: 100px;
    }
    
    .button:hover {
        background-color: #0056d3;
        transform: translateY(-1px);
        box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
    }
    
    .button:active {
        transform: translateY(0);
        box-shadow: 0 4px 15px rgba(0, 122, 255, 0.2);
    }
    
    .button.primary {
        background-color: #007aff;
        color: #ffffff !important;
    }
    
    .button.primary:hover {
        background-color: #0056d3;
    }
    
    .button.small {
        font-size: 1rem;
        height: 2.75rem;
        line-height: 2.75rem;
        padding: 0 1.5rem;
        min-width: 100px;
    }
    
    /* Tiles */
    .tiles {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
        grid-gap: 2rem;
        margin: 0 0 2rem 0;
    }
    
    .tiles article {
        align-items: center;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        cursor: default;
        display: flex;
        height: 20rem;
        justify-content: center;
        text-decoration: none;
        width: 100%;
        border-radius: 0.375rem;
        overflow: hidden;
        transition: transform 0.2s ease, filter 0.2s ease;
    }
    
    .tile {
        background: rgba(255,255,255,0.8);
        border: 1px solid rgba(0,0,0,0.04);
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
    }
    
    .tile:hover {
        background: rgba(255,255,255,0.95);
        border-color: rgba(0,0,0,0.08);
        transform: translateY(-2px);
        box-shadow: 0 8px 35px rgba(0,0,0,0.12);
    }
    
    /* Grid */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr));
        grid-gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .grid-2 {
        grid-template-columns: repeat(auto-fit, minmax(25rem, 1fr));
    }
    
    /* Buttons Container */
    .buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        margin: 1.5rem 0;
    }
    
    /* Results */
    .results {
        background: rgba(255,255,255,0.9);
        border: solid 2px rgba(44,44,44,0.125);
        border-radius: 0.375rem;
        padding: 1.5rem;
        margin-top: 1.5rem;
        box-shadow: 0 2px 8px rgba(44,44,44,0.1);
    }
    
    .result-item {
        background: rgba(248,249,250,0.8);
        border-left: solid 0.25rem #6c757d;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 0.75rem;
        border: solid 1px rgba(44,44,44,0.1);
    }
    
    .result-item:last-child {
        margin-bottom: 0;
    }
    
    .result-item:last-child {
        margin-bottom: 0;
    }
    
    .total-result {
        background: linear-gradient(135deg, #1d1d1f, #2d2d2f);
        border: none;
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        margin-top: 1rem;
        color: #ffffff;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .total-result h4 {
        font-size: 1.75rem;
        margin-bottom: 0.25rem;
        color: #ffffff;
        font-weight: 600;
        letter-spacing: -0.02em;
    }
    
    .total-result p {
        color: #f5f5f7;
        font-weight: 400;
    }
    
    /* Status Messages */
    .message {
        border-radius: 0.375rem;
        margin: 0 0 2rem 0;
        padding: 1rem 1.5rem;
    }
    
    .message.success {
        background: rgba(52, 199, 89, 0.1);
        border-left: solid 3px #34c759;
        color: #1d1d1f;
        border-radius: 12px;
        font-weight: 400;
    }
    
    .message.error {
        background: rgba(255, 59, 48, 0.1);
        border-left: solid 3px #ff3b30;
        color: #1d1d1f;
        border-radius: 12px;
        font-weight: 400;
    }
    
    /* Report */
    .report-box {
        background: rgba(248,249,250,0.95);
        border: solid 2px rgba(44,44,44,0.125);
        border-radius: 0.375rem;
        margin: 1rem 0;
        padding: 0;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(44,44,44,0.1);
    }
    
    .report-box pre {
        background: none;
        border: none;
        color: #2c2c2c;
        font-family: 'Courier New', monospace;
        font-size: 0.8rem;
        line-height: 1.5;
        margin: 0;
        padding: 1.5rem;
        white-space: pre-wrap;
    }
    
    /* Mobile */
    @media screen and (max-width: 980px) {
        html {
            font-size: 16px;
        }
        
        #header {
            padding: 3rem 0 2rem 0;
        }
        
        #header h1 {
            font-size: 2.25rem;
        }
        
        .inner {
            padding: 0 1rem;
        }
        
        section {
            padding: 1.5rem 0 1rem 0;
        }
        
        .grid {
            grid-template-columns: 1fr;
            grid-gap: 1.5rem;
        }
        
        .buttons {
            flex-direction: column;
            align-items: center;
        }
        
        .button {
            width: 100%;
            max-width: 20rem;
        }
    }
    
    @media screen and (max-width: 736px) {
        html {
            font-size: 14px;
        }
        
        #header {
            padding: 2rem 0 1.5rem 0;
        }
        
        #header h1 {
            font-size: 2rem;
        }
        
        .tile {
            padding: 1rem;
        }
        
        .results {
            padding: 1rem;
        }
        
        .result-item {
            padding: 0.75rem;
        }
    }
    
    @media screen and (max-width: 480px) {
        .inner {
            padding: 0 0.5rem;
        }
        
        #header h1 {
            font-size: 1.75rem;
        }
        
        .tile {
            padding: 0.75rem;
        }
    }
</style>

</head>
<body>
    <div id="wrapper">
        <!-- Header -->
        <header id="header">
            <div class="inner">
                <h1>UTO Calculator</h1>
                <p>Unrecorded Time Off Calculator</p>
            </div>
        </header>

    <!-- Main -->
    <div id="main">
        <div class="inner">
            <!-- Guidelines -->
            <section class="special">
                <div class="tile">
                    <h3>UTO Guidelines</h3>
                    <p>UTO is given for callback work done between 12am and 6am, capped at 4.5hrs. Staff resuming work after 12 noon will not be given a meal break.</p>
                    <p><strong>Formula:</strong> UTO = Callback duration after 12am + 1hr bonus (for each activation)</p>
                    <p><strong>Multiple activations:</strong> Total UTO is sum of each activation, +1hr bonus for every activation</p>
                </div>
            </section>

            <!-- Staff Information -->
            <section>
                <div class="tile">
                    <h3>Staff Information</h3>
                    <form>
                        <div class="grid grid-2">
                            <div>
                                <label for="initials">Initials</label>
                                <input type="text" id="initials" placeholder="e.g., BYT" maxlength="5">
                            </div>
                            <div>
                                <label for="modality">On Call Modality</label>
                                <input type="text" id="modality" placeholder="e.g., ICL, IR, HOT" maxlength="50">
                            </div>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Activations -->
            <section>
                <h2>Activations</h2>
                <div id="activations-container"></div>
                
                <div class="buttons">
                    <button class="button primary" onclick="addActivation()">Add Activation</button>
                    <button class="button" onclick="generateReport()">Generate Report</button>
                    <button class="button small" onclick="clearAll()">Clear All</button>
                </div>
            </section>

            <!-- Results -->
            <div id="results"></div>
        </div>
    </div>
</div>

<script>
    let activationCount = 0;
    let activations = [];

    function addActivation() {
        activationCount++;
        const container = document.getElementById('activations-container');
        
        const activationDiv = document.createElement('div');
        activationDiv.className = 'tile';
        activationDiv.id = `activation-${activationCount}`;
        
        activationDiv.innerHTML = `
            <h3>Activation ${activationCount}</h3>
            <form>
                <div class="grid grid-2">
                    <div>
                        <label for="act-${activationCount}">Activation Time (ACT)</label>
                        <input type="text" id="act-${activationCount}" placeholder="e.g., 2300" maxlength="4" oninput="autoCalculate(${activationCount})">
                    </div>
                    <div>
                        <label for="rot-${activationCount}">Room Out Time (ROT)</label>
                        <input type="text" id="rot-${activationCount}" placeholder="e.g., 0200" maxlength="4" oninput="autoCalculate(${activationCount})">
                    </div>
                </div>
                <div class="buttons">
                    <button type="button" class="button small" onclick="removeActivation(${activationCount})">Remove Activation</button>
                </div>
            </form>
            <div id="result-${activationCount}"></div>
        `;
        
        container.appendChild(activationDiv);
    }

    function removeActivation(id) {
        const element = document.getElementById(`activation-${id}`);
        if (element) {
            element.remove();
            activations = activations.filter(a => a.id !== id);
            calculateTotal();
        }
    }

    function autoCalculate(id) {
        const actInput = document.getElementById(`act-${id}`);
        const rotInput = document.getElementById(`rot-${id}`);
        
        if (actInput.value.trim() && rotInput.value.trim()) {
            calculateUTO(id);
        }
    }

    function timeToMinutes(timeStr) {
        let cleanTimeStr = timeStr.replace(':', '').trim();
        
        if (!/^\d{3,4}$/.test(cleanTimeStr)) {
            throw new Error('Invalid time format. Use HHMM (e.g., 2300, 0630)');
        }
        
        cleanTimeStr = cleanTimeStr.padStart(4, '0');
        
        const hours = parseInt(cleanTimeStr.substring(0, 2), 10);
        const minutes = parseInt(cleanTimeStr.substring(2, 4), 10);
        
        if (hours > 23 || minutes > 59) {
            throw new Error('Invalid time. Hours must be 00-23, minutes must be 00-59');
        }
        
        return hours * 60 + minutes;
    }

    function minutesToHours(minutes) {
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        return mins === 0 ? `${hours}h` : `${hours}h ${mins}m`;
    }

    function calculateUTO(id) {
        const actInput = document.getElementById(`act-${id}`);
        const rotInput = document.getElementById(`rot-${id}`);
        const resultDiv = document.getElementById(`result-${id}`);
        
        const actTime = actInput.value.trim();
        const rotTime = rotInput.value.trim();
        
        if (!actTime || !rotTime) {
            resultDiv.innerHTML = '<div class="message error">Please enter both activation time and room out time.</div>';
            return;
        }
        
        try {
            const actMinutes = timeToMinutes(actTime);
            const rotMinutes = timeToMinutes(rotTime);
        
            let adjustedRotMinutes = rotMinutes;
            if (rotMinutes < actMinutes) {
                adjustedRotMinutes += 24 * 60;
            }
            
            const sixAM = 6 * 60;
            let uto = 0;
            let explanation = [];
            
            // Calculate work during UTO period (12am-6am)
            let workDuringUTOPeriod = 0;
            
            if (actMinutes < sixAM && rotMinutes <= sixAM && rotMinutes >= actMinutes) {
                // Case 1: Both ACT and ROT are within 12am-6am same day
                workDuringUTOPeriod = rotMinutes - actMinutes;
                explanation.push(`Work within 12am-6am: ${actTime}-${rotTime} = ${minutesToHours(workDuringUTOPeriod)}`);
            }
            else if (actMinutes >= 18 * 60 && adjustedRotMinutes > 24 * 60) {
                // Case 2: Work crosses midnight
                const workAfterMidnight = Math.min(adjustedRotMinutes - (24 * 60), sixAM);
                workDuringUTOPeriod = workAfterMidnight;
                explanation.push(`Work crossing midnight, UTO period: ${minutesToHours(workDuringUTOPeriod)}`);
            }
            else if (actMinutes < sixAM && adjustedRotMinutes > sixAM) {
                // Case 3: Starts in UTO period, ends after 6am
                workDuringUTOPeriod = sixAM - actMinutes;
                explanation.push(`Work from ${actTime} until 6am: ${minutesToHours(workDuringUTOPeriod)}`);
            }
            
            uto = workDuringUTOPeriod;
            
            // Store activation data
            const existingIndex = activations.findIndex(a => a.id === id);
            const activationData = {
                id: id,
                act: actTime,
                rot: rotTime,
                baseUTO: uto,
                explanation: explanation.join(', ')
            };
            
            if (existingIndex >= 0) {
                activations[existingIndex] = activationData;
            } else {
                activations.push(activationData);
            }
            
            // Display result
            if (uto === 0) {
                resultDiv.innerHTML = `
                    <div class="message error">
                        <strong>No UTO:</strong> No qualifying work between 12am-6am
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="message success">
                        <strong>Base UTO:</strong> ${minutesToHours(uto)}<br>
                        <small>${explanation.join(', ')}</small>
                    </div>
                `;
            }
            
            calculateTotal();
        } catch (error) {
            resultDiv.innerHTML = `<div class="message error">${error.message}</div>`;
        }
    }

    function calculateTotal() {
        if (activations.length === 0) {
            document.getElementById('results').innerHTML = '';
            return;
        }
        
        let totalUTO = 0;
        let resultsHTML = '<div class="results"><h2>UTO Calculation Results</h2>';
        
        activations.forEach((activation, index) => {
            let utoForThisActivation = activation.baseUTO;
            let bonusText = '';
            
            if (index === 0 && activation.baseUTO > 0) {
                utoForThisActivation += 60;
                bonusText = ' (+1h bonus for first activation)';
            }
            
            totalUTO += utoForThisActivation;
            
            resultsHTML += `
                <div class="result-item">
                    <strong>Activation ${activation.id}:</strong> ${activation.act} - ${activation.rot}<br>
                    <strong>UTO:</strong> ${minutesToHours(utoForThisActivation)}${bonusText}<br>
                    <small>Base: ${minutesToHours(activation.baseUTO)}${index === 0 && activation.baseUTO > 0 ? ', +1h bonus = ' + minutesToHours(activation.baseUTO + 60) : ''}</small><br>
                    <small>${activation.explanation}</small>
                </div>
            `;
        });
        
        const cappedTotal = Math.min(totalUTO, 4.5 * 60);
        const wasCapped = totalUTO > 4.5 * 60;
        
        resultsHTML += `
            <div class="total-result">
                <h4>Total UTO: ${minutesToHours(cappedTotal)}</h4>
                ${wasCapped ? '<p>⚠️ Total capped at 4.5 hours maximum</p>' : ''}
            </div>
        </div>`;
        
        document.getElementById('results').innerHTML = resultsHTML;
    }

    function getCurrentDate() {
        const now = new Date();
        const day = now.getDate();
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                           'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const month = monthNames[now.getMonth()];
        const year = now.getFullYear();
        
        return `${day} ${month} ${year}`;
    }

    function generateReport() {
        const initials = document.getElementById('initials').value.trim().toUpperCase();
        const modality = document.getElementById('modality').value.trim().toUpperCase();
        
        if (!initials || !modality) {
            alert('Please enter both initials and modality before generating report.');
            return;
        }
        
        if (activations.length === 0) {
            alert('Please add at least one activation before generating report.');
            return;
        }
        
        let totalUTO = 0;
        activations.forEach((activation, index) => {
            let utoForThisActivation = activation.baseUTO;
            // Add +1 hour bonus to every activation (if it has UTO > 0)
            if (activation.baseUTO > 0) {
                utoForThisActivation += 60;
            }
            totalUTO += utoForThisActivation;
        });
        
        const cappedTotal = Math.min(totalUTO, 4.5 * 60);
        
        let reportText = `${getCurrentDate()}\n`;
        reportText += `${initials} ${modality} on call\n\n`;
        
        activations.forEach((activation) => {
            reportText += `ACT: ${activation.act}\n`;
            reportText += `ROT: ${activation.rot}\n\n`;
        });
        
        reportText += `UTO: ${minutesToHours(cappedTotal)}`;
        
        // Store report text globally for copying
        window.currentReport = reportText;
        
        const reportDiv = document.createElement('div');
        reportDiv.innerHTML = `
            <section>
                <div class="tile">
                    <h3>Generated Report</h3>
                    <div class="report-box">
                        <pre>${reportText}</pre>
                    </div>
                    <div class="buttons">
                        <button class="button primary" onclick="copyReport()">Copy to Clipboard</button>
                    </div>
                </div>
            </section>
        `;
        
        const existingResults = document.getElementById('results');
        if (existingResults.innerHTML) {
            existingResults.appendChild(reportDiv.firstElementChild);
        } else {
            document.getElementById('results').innerHTML = reportDiv.innerHTML;
        }
    }

    function copyReport() {
        const reportText = window.currentReport;
        
        if (!reportText) {
            alert('No report to copy. Please generate a report first.');
            return;
        }
        
        // Try modern clipboard API first
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(reportText).then(() => {
                alert('Report copied to clipboard!');
            }).catch(() => {
                // Fallback if modern API fails
                fallbackCopyToClipboard(reportText);
            });
        } else {
            // Use fallback method
            fallbackCopyToClipboard(reportText);
        }
    }
    
    function fallbackCopyToClipboard(text) {
        // Create temporary textarea
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.left = '-999999px';
        textarea.style.top = '-999999px';
        document.body.appendChild(textarea);
        
        // Select and copy
        textarea.focus();
        textarea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                alert('Report copied to clipboard!');
            } else {
                alert('Copy failed. Please manually select and copy the text above.');
            }
        } catch (err) {
            alert('Copy not supported. Please manually select and copy the text above.');
        }
        
        document.body.removeChild(textarea);
    }

    function clearAll() {
        document.getElementById('activations-container').innerHTML = '';
        document.getElementById('results').innerHTML = '';
        document.getElementById('initials').value = '';
        document.getElementById('modality').value = '';
        activations = [];
        activationCount = 0;
    }

    // Add first activation on load
    addActivation();
</script>

</body>
</html>
