<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UTO Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    
    .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
    }
    
    .header p {
        opacity: 0.9;
        font-size: 1.1rem;
    }
    
    .content {
        padding: 30px;
    }
    
    .guidelines {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
        border-left: 4px solid #4facfe;
    }
    
    .guidelines h3 {
        color: #2d3748;
        margin-bottom: 15px;
        font-size: 1.2rem;
    }
    
    .guidelines ul {
        list-style: none;
        padding-left: 0;
    }
    
    .guidelines li {
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
        color: #4a5568;
    }
    
    .guidelines li:before {
        content: "•";
        color: #4facfe;
        font-weight: bold;
        position: absolute;
        left: 0;
    }
    
    .activation-form {
        background: #ffffff;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }
    
    .activation-form:hover {
        border-color: #4facfe;
        box-shadow: 0 4px 12px rgba(79, 172, 254, 0.1);
    }
    
    .form-row {
        display: flex;
        gap: 20px;
        align-items: end;
        flex-wrap: wrap;
    }
    
    .form-group {
        flex: 1;
        min-width: 120px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2d3748;
    }
    
    .form-group input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }
    
    .form-group input:focus {
        outline: none;
        border-color: #4facfe;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
    }
    
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
    }
    
    .btn-secondary {
        background: #e2e8f0;
        color: #4a5568;
    }
    
    .btn-secondary:hover {
        background: #cbd5e0;
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
    }
    
    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }
    
    .results {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        border-radius: 12px;
        padding: 25px;
        margin-top: 30px;
    }
    
    .results h3 {
        color: #2d3748;
        margin-bottom: 20px;
        font-size: 1.5rem;
        text-align: center;
    }
    
    .activation-result {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #4facfe;
    }
    
    .activation-result:last-child {
        margin-bottom: 0;
    }
    
    .total-uto {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
        padding: 20px;
        border-radius: 12px;
        margin-top: 20px;
    }
    
    .total-uto h4 {
        font-size: 1.8rem;
        margin-bottom: 5px;
    }
    
    .error {
        background: #fed7d7;
        color: #c53030;
        padding: 12px 16px;
        border-radius: 8px;
        margin-top: 10px;
        border-left: 4px solid #e53e3e;
    }
    
    .add-activation {
        text-align: center;
        margin: 20px 0;
    }
    
    @media (max-width: 600px) {
        .form-row {
            flex-direction: column;
        }
        
        .header h1 {
            font-size: 2rem;
        }
        
        .content {
            padding: 20px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>UTO Calculator</h1>
        </div>

```
    <div class="content">
        <div class="guidelines">
            <h3>UTO Guidelines</h3>
            <ul>
                <li>UTO is given for callback work done between 12am and 6am, capped at 4.5hrs</li>
                <li>Staff resuming work after 12 noon will not be given a meal break</li>
                <li>UTO = Callback duration after 12am + 1hr post ROT (first activation only)</li>
                <li>Multiple activations: Total UTO is sum of each activation, bonus +1hr only for first</li>
            </ul>
        </div>
        
        <div class="activation-form" style="background: #f0f9ff; border-color: #0ea5e9;">
            <h3 style="margin-bottom: 20px; color: #0c4a6e;">Staff Information</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="initials">Initials</label>
                    <input type="text" id="initials" placeholder="e.g., BYT" maxlength="5">
                </div>
                <div class="form-group">
                    <label for="modality">On Call Modality</label>
                    <input type="text" id="modality" placeholder="e.g., ICL, IR, HOT" maxlength="50">
                </div>
            </div>
        </div>
        
        <div id="activations-container"></div>
        
        <div class="add-activation">
            <button class="btn btn-primary" onclick="addActivation()">+ Add Activation</button>
            <button class="btn btn-secondary" onclick="calculateTotal()" style="margin-left: 10px;">Calculate Total UTO</button>
            <button class="btn btn-secondary" onclick="generateReport()" style="margin-left: 10px;">Generate Report</button>
            <button class="btn btn-danger" onclick="clearAll()" style="margin-left: 10px;">Clear All</button>
        </div>
        
        <div id="results"></div>
    </div>
</div>

<script>
    let activationCount = 0;
    let activations = [];

    function addActivation() {
        activationCount++;
        const container = document.getElementById('activations-container');
        
        const activationDiv = document.createElement('div');
        activationDiv.className = 'activation-form';
        activationDiv.id = `activation-${activationCount}`;
        
        activationDiv.innerHTML = `
            <div class="form-row">
                <div class="form-group">
                    <label for="act-${activationCount}">Activation Time (ACT)</label>
                    <input type="text" id="act-${activationCount}" placeholder="e.g., 2300" maxlength="4">
                </div>
                <div class="form-group">
                    <label for="rot-${activationCount}">Room Out Time (ROT)</label>
                    <input type="text" id="rot-${activationCount}" placeholder="e.g., 0200" maxlength="4">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="calculateUTO(${activationCount})">Calculate</button>
                    <button class="btn btn-danger" onclick="removeActivation(${activationCount})" style="margin-left: 10px;">Remove</button>
                </div>
            </div>
            <div id="result-${activationCount}"></div>
        `;
        
        container.appendChild(activationDiv);
    }

    function removeActivation(id) {
        const element = document.getElementById(`activation-${id}`);
        if (element) {
            element.remove();
            // Remove from activations array
            activations = activations.filter(a => a.id !== id);
            calculateTotal();
        }
    }

    function timeToMinutes(timeStr) {
        // Handle both HHMM and HH:MM formats
        let cleanTimeStr = timeStr.replace(':', '').trim();
        
        // Validate format (should be 3-4 digits)
        if (!/^\d{3,4}$/.test(cleanTimeStr)) {
            throw new Error('Invalid time format. Use HHMM (e.g., 2300, 0630)');
        }
        
        // Pad to 4 digits if needed
        cleanTimeStr = cleanTimeStr.padStart(4, '0');
        
        const hours = parseInt(cleanTimeStr.substring(0, 2), 10);
        const minutes = parseInt(cleanTimeStr.substring(2, 4), 10);
        
        // Validate ranges
        if (hours > 23 || minutes > 59) {
            throw new Error('Invalid time. Hours must be 00-23, minutes must be 00-59');
        }
        
        return hours * 60 + minutes;
    }

    function minutesToHours(minutes) {
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        return mins === 0 ? `${hours}h` : `${hours}h ${mins}m`;
    }

    function calculateUTO(id) {
        const actInput = document.getElementById(`act-${id}`);
        const rotInput = document.getElementById(`rot-${id}`);
        const resultDiv = document.getElementById(`result-${id}`);
        
        const actTime = actInput.value.trim();
        const rotTime = rotInput.value.trim();
        
        if (!actTime || !rotTime) {
            resultDiv.innerHTML = '<div class="error">Please enter both activation time and room out time.</div>';
            return;
        }
        
        try {
            const actMinutes = timeToMinutes(actTime);
            const rotMinutes = timeToMinutes(rotTime);
        
        // Handle crossing midnight
        let adjustedRotMinutes = rotMinutes;
        if (rotMinutes < actMinutes) {
            adjustedRotMinutes += 24 * 60; // Add 24 hours
        }
        
        const totalDuration = adjustedRotMinutes - actMinutes;
        
        // Key time points in minutes
        const midnight = 0; // 00:00
        const sixAM = 6 * 60; // 06:00
        
        let uto = 0;
        let explanation = [];
        
        // Calculate work during UTO period (12am-6am)
        let workDuringUTOPeriod = 0;
        
        // Determine the actual start and end times for UTO calculation
        let utoStartMinutes, utoEndMinutes;
        
        // UTO period is 12am-6am (0-360 minutes)
        if (actMinutes < sixAM && rotMinutes <= sixAM && rotMinutes >= actMinutes) {
            // Case 1: Both ACT and ROT are within 12am-6am same day
            utoStartMinutes = Math.max(actMinutes, 0); // Start at ACT or midnight, whichever is later
            utoEndMinutes = Math.min(rotMinutes, sixAM); // End at ROT or 6am, whichever is earlier
            workDuringUTOPeriod = utoEndMinutes - utoStartMinutes;
            explanation.push(`Work within 12am-6am: ${actTime}-${rotTime} = ${minutesToHours(workDuringUTOPeriod)}`);
        }
        else if (actMinutes >= 18 * 60 && adjustedRotMinutes > 24 * 60) {
            // Case 2: Work crosses midnight (starts evening, ends next morning)
            utoStartMinutes = 24 * 60; // Start counting from midnight
            utoEndMinutes = Math.min(adjustedRotMinutes, 24 * 60 + sixAM); // End at ROT or 6am
            workDuringUTOPeriod = utoEndMinutes - utoStartMinutes;
            explanation.push(`Work crossing midnight, UTO period: ${minutesToHours(workDuringUTOPeriod)}`);
        }
        else if (actMinutes < sixAM && adjustedRotMinutes > sixAM) {
            // Case 3: Starts in UTO period, ends after 6am
            utoStartMinutes = actMinutes;
            utoEndMinutes = sixAM;
            workDuringUTOPeriod = utoEndMinutes - utoStartMinutes;
            explanation.push(`Work from ${actTime} until 6am: ${minutesToHours(workDuringUTOPeriod)}`);
        }
        
        uto = workDuringUTOPeriod; // No cap on base UTO - only cap final total
        
        // Store activation data
        const existingIndex = activations.findIndex(a => a.id === id);
        const activationData = {
            id: id,
            act: actTime,
            rot: rotTime,
            baseUTO: uto,
            explanation: explanation.join(', ')
        };
        
        if (existingIndex >= 0) {
            activations[existingIndex] = activationData;
        } else {
            activations.push(activationData);
        }
        
        // Display result
        if (uto === 0) {
            resultDiv.innerHTML = `
                <div style="margin-top: 15px; padding: 15px; background: #fed7d7; border-radius: 8px; color: #c53030;">
                    <strong>No UTO:</strong> No qualifying work between 12am-6am
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div style="margin-top: 15px; padding: 15px; background: #c6f6d5; border-radius: 8px; color: #22543d;">
                    <strong>Base UTO:</strong> ${minutesToHours(uto)}<br>
                    <small>${explanation.join(', ')}</small>
                </div>
            `;
        }
        
        calculateTotal();
    } catch (error) {
        resultDiv.innerHTML = `<div class="error">${error.message}</div>`;
    }
    }

    function calculateTotal() {
        if (activations.length === 0) {
            document.getElementById('results').innerHTML = '';
            return;
        }
        
        // Use activations in the order they were added (first added = first activation)
        let totalUTO = 0;
        let resultsHTML = '<div class="results"><h3>UTO Calculation Results</h3>';
        
        activations.forEach((activation, index) => {
            let utoForThisActivation = activation.baseUTO;
            let bonusText = '';
            
            // Add +1 hour bonus only to the first activation (if it has UTO > 0)
            if (index === 0 && activation.baseUTO > 0) {
                utoForThisActivation += 60; // Add 1 hour (60 minutes)
                bonusText = ' (+1h bonus for first activation)';
            }
            
            totalUTO += utoForThisActivation;
            
            resultsHTML += `
                <div class="activation-result">
                    <strong>Activation ${activation.id}:</strong> ${activation.act} - ${activation.rot}<br>
                    <strong>UTO:</strong> ${minutesToHours(utoForThisActivation)}${bonusText}<br>
                    <small>Base: ${minutesToHours(activation.baseUTO)}${index === 0 && activation.baseUTO > 0 ? ', +1h bonus = ' + minutesToHours(activation.baseUTO + 60) : ''}</small><br>
                    <small>${activation.explanation}</small>
                </div>
            `;
        });
        
        // Apply overall 4.5 hour cap to total
        const cappedTotal = Math.min(totalUTO, 4.5 * 60);
        const wasCapped = totalUTO > 4.5 * 60;
        
        resultsHTML += `
            <div class="total-uto">
                <h4>Total UTO: ${minutesToHours(cappedTotal)}</h4>
                ${wasCapped ? '<p>⚠️ Total capped at 4.5 hours maximum</p>' : ''}
            </div>
        </div>`;
        
        document.getElementById('results').innerHTML = resultsHTML;
    }

    function formatTimeFromMinutes(minutes) {
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        return mins === 0 ? `${hours.toString().padStart(2, '0')}00` : `${hours.toString().padStart(2, '0')}${mins.toString().padStart(2, '0')}`;
    }

    function getCurrentDate() {
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        return now.toLocaleDateString('en-US', options);
    }

    function generateReport() {
        const initials = document.getElementById('initials').value.trim().toUpperCase();
        const modality = document.getElementById('modality').value.trim();
        
        if (!initials || !modality) {
            alert('Please enter both initials and modality before generating report.');
            return;
        }
        
        if (activations.length === 0) {
            alert('Please add at least one activation before generating report.');
            return;
        }
        
        // Calculate total UTO for report - use order of entry
        let totalUTO = 0;
        activations.forEach((activation, index) => {
            let utoForThisActivation = activation.baseUTO;
            if (index === 0 && activation.baseUTO > 0) {
                utoForThisActivation += 60; // Add bonus to first added activation
            }
            totalUTO += utoForThisActivation;
        });
        
        const cappedTotal = Math.min(totalUTO, 4.5 * 60);
        
        // Generate report text
        let reportText = `${getCurrentDate()}\n`;
        reportText += `${initials} ${modality} on call\n\n`;
        
        activations.forEach((activation) => {
            reportText += `ACT: ${activation.act}\n`;
            reportText += `ROT: ${activation.rot}\n\n`;
        });
        
        reportText += `UTO: ${minutesToHours(cappedTotal)}`;
        
        // Display report in a copyable format
        const reportDiv = document.createElement('div');
        reportDiv.innerHTML = `
            <div class="results">
                <h3>Generated Report</h3>
                <div style="background: white; padding: 20px; border-radius: 8px; border: 2px dashed #4facfe; margin: 20px 0;">
                    <pre style="font-family: monospace; white-space: pre-wrap; margin: 0; font-size: 14px; line-height: 1.5;">${reportText}</pre>
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="copyReport('${reportText.replace(/'/g, "\\'")}')">Copy to Clipboard</button>
                </div>
            </div>
        `;
        
        // Replace existing results or add after them
        const existingResults = document.getElementById('results');
        if (existingResults.innerHTML) {
            existingResults.appendChild(reportDiv.firstElementChild);
        } else {
            document.getElementById('results').innerHTML = reportDiv.innerHTML;
        }
    }

    function copyReport(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('Report copied to clipboard!');
        }).catch(() => {
            // Fallback for older browsers
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('Report copied to clipboard!');
        });
    }

    function clearAll() {
        document.getElementById('activations-container').innerHTML = '';
        document.getElementById('results').innerHTML = '';
        activations = [];
        activationCount = 0;
    }

    // Add first activation on load
    addActivation();
</script>
```

</body>
</html>