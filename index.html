<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UTO Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;700&display=swap');

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Noto Sans', Arial, sans-serif;
        background: radial-gradient(ellipse at center, #2e3440 0%, #1e2025 100%);
        background-attachment: fixed;
        min-height: 100vh;
        color: #f8f8f2;
        line-height: 1.6;
        padding: 20px 10px;
    }
    
    .container {
        max-width: 900px;
        margin: 0 auto;
        background: linear-gradient(135deg, #2e3440 0%, #3b4252 100%);
        border-radius: 8px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        border: 1px solid #4c566a;
        overflow: hidden;
        position: relative;
    }
    
    .container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #e74c3c, #c0392b, #a93226);
    }
    
    .header {
        background: linear-gradient(135deg, #434c5e 0%, #3b4252 100%);
        color: #eceff4;
        padding: 40px 30px;
        text-align: center;
        border-bottom: 1px solid #4c566a;
    }
    
    .header h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        font-weight: 300;
        letter-spacing: -1px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .header h1::after {
        content: '';
        display: block;
        width: 60px;
        height: 2px;
        background: #e74c3c;
        margin: 20px auto 0;
    }
    
    .content {
        padding: 30px;
    }
    
    .section {
        margin-bottom: 30px;
    }
    
    .guidelines {
        background: rgba(59, 66, 82, 0.7);
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 30px;
        border: 1px solid #4c566a;
        backdrop-filter: blur(10px);
    }
    
    .guidelines h3 {
        color: #e74c3c;
        margin-bottom: 20px;
        font-size: 1.3rem;
        font-weight: 600;
    }
    
    .guidelines ul {
        list-style: none;
        padding-left: 0;
    }
    
    .guidelines li {
        margin-bottom: 12px;
        padding-left: 25px;
        position: relative;
        color: #d8dee9;
        font-size: 0.95rem;
    }
    
    .guidelines li:before {
        content: "▸";
        color: #c0392b;
        font-weight: bold;
        position: absolute;
        left: 0;
    }
    
    .staff-info {
        background: rgba(67, 76, 94, 0.7);
        border: 1px solid #c0392b;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        backdrop-filter: blur(10px);
    }
    
    .staff-info h3 {
        color: #e74c3c;
        margin-bottom: 20px;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .activation-form {
        background: rgba(59, 66, 82, 0.5);
        border: 1px solid #4c566a;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }
    
    .activation-form:hover {
        border-color: #c0392b;
        background: rgba(59, 66, 82, 0.7);
        box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 20px;
        align-items: end;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-group label {
        margin-bottom: 8px;
        font-weight: 600;
        color: #d8dee9;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .form-group input {
        padding: 12px 16px;
        border: 1px solid #4c566a;
        border-radius: 6px;
        font-size: 1rem;
        background: rgba(46, 52, 64, 0.8);
        color: #eceff4;
        transition: all 0.3s ease;
        font-family: 'Noto Sans', monospace;
    }
    
    .form-group input:focus {
        outline: none;
        border-color: #e74c3c;
        box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
        background: rgba(46, 52, 64, 1);
    }
    
    .form-group input::placeholder {
        color: #616e88;
        font-style: italic;
    }
    
    .btn {
        padding: 12px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: 'Noto Sans', Arial, sans-serif;
        white-space: nowrap;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: #eceff4;
        border: 1px solid #e74c3c;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #ec7063, #e74c3c);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
    }
    
    .btn-secondary {
        background: rgba(67, 76, 94, 0.8);
        color: #d8dee9;
        border: 1px solid #4c566a;
    }
    
    .btn-secondary:hover {
        background: rgba(67, 76, 94, 1);
        border-color: #c0392b;
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #a93226, #922b21);
        color: #eceff4;
        border: 1px solid #a93226;
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #cb4335, #a93226);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(169, 50, 38, 0.3);
    }
    
    .results {
        background: rgba(46, 52, 64, 0.8);
        border: 1px solid #4c566a;
        border-radius: 8px;
        padding: 25px;
        margin-top: 30px;
        backdrop-filter: blur(10px);
    }
    
    .results h3 {
        color: #e74c3c;
        margin-bottom: 25px;
        font-size: 1.4rem;
        text-align: center;
        font-weight: 600;
    }
    
    .activation-result {
        background: rgba(59, 66, 82, 0.6);
        border-left: 4px solid #c0392b;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid rgba(76, 86, 106, 0.5);
    }
    
    .activation-result:last-of-type {
        margin-bottom: 20px;
    }
    
    .activation-result strong {
        color: #e74c3c;
    }
    
    .activation-result small {
        color: #ec7063;
    }
    
    .total-uto {
        background: linear-gradient(135deg, #c0392b, #434c5e);
        color: #eceff4;
        text-align: center;
        padding: 25px;
        border-radius: 8px;
        border: 1px solid #c0392b;
        box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }
    
    .total-uto h4 {
        font-size: 1.8rem;
        margin-bottom: 8px;
        font-weight: 300;
        color: #e74c3c;
    }
    
    .total-uto p {
        color: #d08770;
        font-weight: 600;
    }
    
    .error {
        background: rgba(169, 50, 38, 0.2);
        color: #a93226;
        padding: 15px;
        border-radius: 6px;
        margin-top: 10px;
        border-left: 4px solid #a93226;
        border: 1px solid rgba(169, 50, 38, 0.3);
    }
    
    .success {
        background: rgba(163, 190, 140, 0.2);
        color: #a3be8c;
        padding: 15px;
        border-radius: 6px;
        margin-top: 10px;
        border-left: 4px solid #a3be8c;
        border: 1px solid rgba(163, 190, 140, 0.3);
    }
    
    .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 30px 0;
        flex-wrap: wrap;
    }
    
    .report-box {
        background: rgba(46, 52, 64, 0.9);
        padding: 25px;
        border-radius: 8px;
        border: 2px dashed #c0392b;
        margin: 25px 0;
        backdrop-filter: blur(10px);
    }
    
    .report-box pre {
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        margin: 0;
        font-size: 14px;
        line-height: 1.5;
        color: #d8dee9;
        background: rgba(59, 66, 82, 0.5);
        padding: 20px;
        border-radius: 6px;
        border: 1px solid #4c566a;
    }
    
    /* Mobile Responsiveness */
    @media (max-width: 768px) {
        body {
            padding: 10px 5px;
        }
        
        .container {
            margin: 0;
            border-radius: 0;
        }
        
        .header {
            padding: 30px 20px;
        }
        
        .header h1 {
            font-size: 2.2rem;
        }
        
        .content {
            padding: 20px 15px;
        }
        
        .form-row {
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .button-group {
            flex-direction: column;
            gap: 12px;
        }
        
        .btn {
            width: 100%;
            justify-self: center;
        }
        
        .guidelines,
        .staff-info,
        .activation-form {
            padding: 20px 15px;
        }
        
        .results {
            padding: 20px 15px;
        }
        
        .activation-result {
            padding: 15px;
        }
        
        .total-uto {
            padding: 20px 15px;
        }
        
        .total-uto h4 {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        .header h1 {
            font-size: 1.8rem;
        }
        
        .content {
            padding: 15px 10px;
        }
        
        .guidelines,
        .staff-info,
        .activation-form,
        .results {
            padding: 15px 10px;
        }
        
        .button-group {
            gap: 10px;
        }
        
        .btn {
            padding: 12px 16px;
            font-size: 0.85rem;
        }
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
        .container {
            border: 2px solid #eceff4;
        }
        
        .form-group input {
            border: 2px solid #d8dee9;
        }
        
        .btn {
            border-width: 2px;
        }
    }
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>UTO Calculator</h1>
        </div>

```
    <div class="content">
        <div class="section">
            <div class="guidelines">
                <h3>UTO Guidelines</h3>
                <ul>
                    <li>UTO is given for callback work done between 12am and 6am, capped at 4.5hrs</li>
                    <li>Staff resuming work after 12 noon will not be given a meal break</li>
                    <li>UTO = Callback duration after 12am + 1hr post ROT (first activation only)</li>
                    <li>Multiple activations: Total UTO is sum of each activation, bonus +1hr only for first</li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <div class="staff-info">
                <h3>Staff Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="initials">Initials</label>
                        <input type="text" id="initials" placeholder="e.g., BYT" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label for="modality">On Call Modality</label>
                        <input type="text" id="modality" placeholder="e.g., ICL, IR, HOT" maxlength="50">
                    </div>
                </div>
            </div>
        </div>
        
        <div id="activations-container"></div>
        
        <div class="button-group">
            <button class="btn btn-primary" onclick="addActivation()">+ Add Activation</button>
            <button class="btn btn-secondary" onclick="generateReport()">Generate Report</button>
            <button class="btn btn-danger" onclick="clearAll()">Clear All</button>
        </div>
        
        <div id="results"></div>
    </div>
</div>

<script>
    let activationCount = 0;
    let activations = [];

    function addActivation() {
        activationCount++;
        const container = document.getElementById('activations-container');
        
        const activationDiv = document.createElement('div');
        activationDiv.className = 'activation-form';
        activationDiv.id = `activation-${activationCount}`;
        
        activationDiv.innerHTML = `
            <div class="form-row">
                <div class="form-group">
                    <label for="act-${activationCount}">Activation Time (ACT)</label>
                    <input type="text" id="act-${activationCount}" placeholder="e.g., 2300" maxlength="4" oninput="autoCalculate(${activationCount})">
                </div>
                <div class="form-group">
                    <label for="rot-${activationCount}">Room Out Time (ROT)</label>
                    <input type="text" id="rot-${activationCount}" placeholder="e.g., 0200" maxlength="4" oninput="autoCalculate(${activationCount})">
                </div>
                <div class="form-group">
                    <button class="btn btn-danger" onclick="removeActivation(${activationCount})">Remove</button>
                </div>
            </div>
            <div id="result-${activationCount}"></div>
        `;
        
        container.appendChild(activationDiv);
    }

    function removeActivation(id) {
        const element = document.getElementById(`activation-${id}`);
        if (element) {
            element.remove();
            // Remove from activations array
            activations = activations.filter(a => a.id !== id);
            calculateTotal();
        }
    }

    function autoCalculate(id) {
        const actInput = document.getElementById(`act-${id}`);
        const rotInput = document.getElementById(`rot-${id}`);
        
        // Only calculate if both fields have values
        if (actInput.value.trim() && rotInput.value.trim()) {
            calculateUTO(id);
        }
    }

    function timeToMinutes(timeStr) {
        // Handle both HHMM and HH:MM formats
        let cleanTimeStr = timeStr.replace(':', '').trim();
        
        // Validate format (should be 3-4 digits)
        if (!/^\d{3,4}$/.test(cleanTimeStr)) {
            throw new Error('Invalid time format. Use HHMM (e.g., 2300, 0630)');
        }
        
        // Pad to 4 digits if needed
        cleanTimeStr = cleanTimeStr.padStart(4, '0');
        
        const hours = parseInt(cleanTimeStr.substring(0, 2), 10);
        const minutes = parseInt(cleanTimeStr.substring(2, 4), 10);
        
        // Validate ranges
        if (hours > 23 || minutes > 59) {
            throw new Error('Invalid time. Hours must be 00-23, minutes must be 00-59');
        }
        
        return hours * 60 + minutes;
    }

    function minutesToHours(minutes) {
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        return mins === 0 ? `${hours}h` : `${hours}h ${mins}m`;
    }

    function calculateUTO(id) {
        const actInput = document.getElementById(`act-${id}`);
        const rotInput = document.getElementById(`rot-${id}`);
        const resultDiv = document.getElementById(`result-${id}`);
        
        const actTime = actInput.value.trim();
        const rotTime = rotInput.value.trim();
        
        if (!actTime || !rotTime) {
            resultDiv.innerHTML = '<div class="error">Please enter both activation time and room out time.</div>';
            return;
        }
        
        try {
            const actMinutes = timeToMinutes(actTime);
            const rotMinutes = timeToMinutes(rotTime);
        
        // Handle crossing midnight
        let adjustedRotMinutes = rotMinutes;
        if (rotMinutes < actMinutes) {
            adjustedRotMinutes += 24 * 60; // Add 24 hours
        }
        
        const totalDuration = adjustedRotMinutes - actMinutes;
        
        // Key time points in minutes
        const midnight = 0; // 00:00
        const sixAM = 6 * 60; // 06:00
        
        let uto = 0;
        let explanation = [];
        
        // Calculate work during UTO period (12am-6am)
        let workDuringUTOPeriod = 0;
        
        // Determine the actual start and end times for UTO calculation
        let utoStartMinutes, utoEndMinutes;
        
        // UTO period is 12am-6am (0-360 minutes)
        if (actMinutes < sixAM && rotMinutes <= sixAM && rotMinutes >= actMinutes) {
            // Case 1: Both ACT and ROT are within 12am-6am same day
            utoStartMinutes = Math.max(actMinutes, 0); // Start at ACT or midnight, whichever is later
            utoEndMinutes = Math.min(rotMinutes, sixAM); // End at ROT or 6am, whichever is earlier
            workDuringUTOPeriod = utoEndMinutes - utoStartMinutes;
            explanation.push(`Work within 12am-6am: ${actTime}-${rotTime} = ${minutesToHours(workDuringUTOPeriod)}`);
        }
        else if (actMinutes >= 18 * 60 && adjustedRotMinutes > 24 * 60) {
            // Case 2: Work crosses midnight (starts evening, ends next morning)
            utoStartMinutes = 24 * 60; // Start counting from midnight
            utoEndMinutes = Math.min(adjustedRotMinutes, 24 * 60 + sixAM); // End at ROT or 6am
            workDuringUTOPeriod = utoEndMinutes - utoStartMinutes;
            explanation.push(`Work crossing midnight, UTO period: ${minutesToHours(workDuringUTOPeriod)}`);
        }
        else if (actMinutes < sixAM && adjustedRotMinutes > sixAM) {
            // Case 3: Starts in UTO period, ends after 6am
            utoStartMinutes = actMinutes;
            utoEndMinutes = sixAM;
            workDuringUTOPeriod = utoEndMinutes - utoStartMinutes;
            explanation.push(`Work from ${actTime} until 6am: ${minutesToHours(workDuringUTOPeriod)}`);
        }
        
        uto = workDuringUTOPeriod; // No cap on base UTO - only cap final total
        
        // Store activation data
        const existingIndex = activations.findIndex(a => a.id === id);
        const activationData = {
            id: id,
            act: actTime,
            rot: rotTime,
            baseUTO: uto,
            explanation: explanation.join(', ')
        };
        
        if (existingIndex >= 0) {
            activations[existingIndex] = activationData;
        } else {
            activations.push(activationData);
        }
        
        // Display result
        if (uto === 0) {
            resultDiv.innerHTML = `
                <div class="error">
                    <strong>No UTO:</strong> No qualifying work between 12am-6am
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="success">
                    <strong>Base UTO:</strong> ${minutesToHours(uto)}<br>
                    <small>${explanation.join(', ')}</small>
                </div>
            `;
        }
        
        calculateTotal();
    } catch (error) {
        resultDiv.innerHTML = `<div class="error">${error.message}</div>`;
    }
    }

    function calculateTotal() {
        if (activations.length === 0) {
            document.getElementById('results').innerHTML = '';
            return;
        }
        
        // Use activations in the order they were added (first added = first activation)
        let totalUTO = 0;
        let resultsHTML = '<div class="results"><h3>UTO Calculation Results</h3>';
        
        activations.forEach((activation, index) => {
            let utoForThisActivation = activation.baseUTO;
            let bonusText = '';
            
            // Add +1 hour bonus only to the first activation (if it has UTO > 0)
            if (index === 0 && activation.baseUTO > 0) {
                utoForThisActivation += 60; // Add 1 hour (60 minutes)
                bonusText = ' (+1h bonus for first activation)';
            }
            
            totalUTO += utoForThisActivation;
            
            resultsHTML += `
                <div class="activation-result">
                    <strong>Activation ${activation.id}:</strong> ${activation.act} - ${activation.rot}<br>
                    <strong>UTO:</strong> ${minutesToHours(utoForThisActivation)}${bonusText}<br>
                    <small>Base: ${minutesToHours(activation.baseUTO)}${index === 0 && activation.baseUTO > 0 ? ', +1h bonus = ' + minutesToHours(activation.baseUTO + 60) : ''}</small><br>
                    <small>${activation.explanation}</small>
                </div>
            `;
        });
        
        // Apply overall 4.5 hour cap to total
        const cappedTotal = Math.min(totalUTO, 4.5 * 60);
        const wasCapped = totalUTO > 4.5 * 60;
        
        resultsHTML += `
            <div class="total-uto">
                <h4>Total UTO: ${minutesToHours(cappedTotal)}</h4>
                ${wasCapped ? '<p>⚠️ Total capped at 4.5 hours maximum</p>' : ''}
            </div>
        </div>`;
        
        document.getElementById('results').innerHTML = resultsHTML;
    }

    function formatTimeFromMinutes(minutes) {
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        return mins === 0 ? `${hours.toString().padStart(2, '0')}00` : `${hours.toString().padStart(2, '0')}${mins.toString().padStart(2, '0')}`;
    }

    function getCurrentDate() {
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        return now.toLocaleDateString('en-US', options);
    }

    function generateReport() {
        const initials = document.getElementById('initials').value.trim().toUpperCase();
        const modality = document.getElementById('modality').value.trim();
        
        if (!initials || !modality) {
            alert('Please enter both initials and modality before generating report.');
            return;
        }
        
        if (activations.length === 0) {
            alert('Please add at least one activation before generating report.');
            return;
        }
        
        // Calculate total UTO for report - use order of entry
        let totalUTO = 0;
        activations.forEach((activation, index) => {
            let utoForThisActivation = activation.baseUTO;
            if (index === 0 && activation.baseUTO > 0) {
                utoForThisActivation += 60; // Add bonus to first added activation
            }
            totalUTO += utoForThisActivation;
        });
        
        const cappedTotal = Math.min(totalUTO, 4.5 * 60);
        
        // Generate report text
        let reportText = `${getCurrentDate()}\n`;
        reportText += `${initials} ${modality} on call\n\n`;
        
        activations.forEach((activation) => {
            reportText += `ACT: ${activation.act}\n`;
            reportText += `ROT: ${activation.rot}\n\n`;
        });
        
        reportText += `UTO: ${minutesToHours(cappedTotal)}`;
        
        // Display report in a copyable format
        const reportDiv = document.createElement('div');
        reportDiv.innerHTML = `
            <div class="results">
                <h3>Generated Report</h3>
                <div class="report-box">
                    <pre>${reportText}</pre>
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="copyReport('${reportText.replace(/'/g, "\\'")}')">Copy to Clipboard</button>
                </div>
            </div>
        `;
        
        // Replace existing results or add after them
        const existingResults = document.getElementById('results');
        if (existingResults.innerHTML) {
            existingResults.appendChild(reportDiv.firstElementChild);
        } else {
            document.getElementById('results').innerHTML = reportDiv.innerHTML;
        }
    }

    function copyReport(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('Report copied to clipboard!');
        }).catch(() => {
            // Fallback for older browsers
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('Report copied to clipboard!');
        });
    }

    function clearAll() {
        document.getElementById('activations-container').innerHTML = '';
        document.getElementById('results').innerHTML = '';
        activations = [];
        activationCount = 0;
    }

    // Add first activation on load
    addActivation();
</script>
```

</body>
</html>
